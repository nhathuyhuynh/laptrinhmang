<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>WebSocket Chat</title>
<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:linear-gradient(135deg,#667eea,#764ba2);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}
.app{
    width:900px;
    height:550px;
    background:#fff;
    border-radius:15px;
    display:flex;
    overflow:hidden;
}
.sidebar{
    width:220px;
    background:#f3f4f6;
    padding:15px;
}
.sidebar li{
    list-style:none;
    padding:10px;
    margin-bottom:5px;
    cursor:pointer;
    border-radius:8px;
}
.sidebar li.active{
    background:#667eea;
    color:white;
}
.chat{
    flex:1;
    display:flex;
    flex-direction:column;
}
.header{
    padding:15px;
    background:#667eea;
    color:white;
}
.messages{
    flex:1;
    padding:15px;
    overflow-y:auto;
}
.message{
    margin-bottom:10px;
}
.input{
    display:flex;
    padding:10px;
}
.input input{
    flex:1;
    padding:10px;
}
.input button{
    padding:10px 20px;
    margin-left:10px;
}
</style>
</head>

<body>

<div class="app">

<div class="sidebar">
    <b>Rooms</b>
    <ul id="rooms">
        <li class="active" onclick="switchRoom('general')">general</li>
        <li onclick="switchRoom('study')">study</li>
        <li onclick="switchRoom('game')">game</li>
    </ul>
</div>

<div class="chat">
    <div class="header">
        ðŸ‘¤ <b id="user"></b> | ðŸ“Œ <b id="room"></b>
    </div>

    <div class="messages" id="messages"></div>

    <div class="input">
        <input id="msg" placeholder="Type message...">
        <button onclick="send()">Send</button>
    </div>
</div>

</div>

<script>
const username = localStorage.getItem("username") || "guest";
let currentRoom = localStorage.getItem("room") || "general";

document.getElementById("user").innerText = username;
document.getElementById("room").innerText = currentRoom;

let ws = null;

function connect(){
    ws = new WebSocket("ws://localhost:8765");

    ws.onopen = ()=>{
        ws.send(JSON.stringify({
            type:"login",
            username: username,
            room: currentRoom
        }));
    };

    ws.onmessage = e=>{
        const d = JSON.parse(e.data);
        if(d.type === "message"){
            add(d.sender, d.message);
        }
    };
}

function add(u,m){
    const div = document.createElement("div");
    div.className="message";
    div.innerHTML=`<b>${u}:</b> ${m}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function send(){
    const t = msg.value.trim();
    if(!t) return;
    ws.send(JSON.stringify({type:"message",message:t}));
    msg.value="";
}

function switchRoom(r){
    if(r===currentRoom) return;
    currentRoom=r;
    localStorage.setItem("room",r);
    document.getElementById("room").innerText=r;
    messages.innerHTML="";
    ws.close();
    connect();
}

connect();
</script>

</body>
</html>
