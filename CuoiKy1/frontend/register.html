<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ÄÄƒng kÃ½ tÃ i khoáº£n</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container">
    <h1>ğŸ“ ÄÄƒng kÃ½</h1>

    <input id="u" placeholder="TÃªn Ä‘Äƒng nháº­p má»›i" autofocus>
    <input id="p" type="password" placeholder="Máº­t kháº©u">

    <button onclick="register()">ÄÄƒng KÃ½</button>

    <div class="link" onclick="window.location.href='login.html'">
        ÄÃ£ cÃ³ tÃ i khoáº£n? <b>ÄÄƒng nháº­p ngay</b>
    </div>
</div>

<script>
    const ws = new WebSocket("ws://localhost:8765");

    ws.onopen = () => {
        console.log("ÄÃ£ káº¿t ná»‘i Server Ä‘Äƒng kÃ½!");
    };

    function register() {
        const u = document.getElementById("u").value.trim();
        const p = document.getElementById("p").value.trim();

        if (!u || !p) {
            alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃªn vÃ  máº­t kháº©u!");
            return;
        }

        // Gá»­i lá»‡nh Ä‘Äƒng kÃ½
        if (ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify({
                type: "register",
                username: u,
                password: p
            }));
        } else {
            alert("ChÆ°a káº¿t ná»‘i Ä‘Æ°á»£c Server. HÃ£y F5 thá»­ láº¡i!");
        }
    }

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        // --- Náº¾U THÃ€NH CÃ”NG (ÄOáº N ÄÃƒ Sá»¬A) ---
        if (data.type === "register_ok") {
            // DÃ¹ng confirm Ä‘á»ƒ hiá»‡n báº£ng OK/Cancel. Báº¥m gÃ¬ cÅ©ng sáº½ chuyá»ƒn trang.
            if(confirm("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! Báº¥m OK Ä‘á»ƒ Ä‘Äƒng nháº­p ngay.")) {
                // replace tá»‘t hÆ¡n href vÃ¬ nÃ³ khÃ´ng cho user báº¥m Back Ä‘á»ƒ quay láº¡i trang Ä‘Äƒng kÃ½
                window.location.replace("login.html");
            } else {
                window.location.href = "login.html";
            }
        }

        // --- Náº¾U THáº¤T Báº I ---
        if (data.type === "register_fail") {
            alert("âŒ Lá»—i: " + (data.message || "TÃªn nÃ y Ä‘Ã£ cÃ³ ngÆ°á»i dÃ¹ng!"));
        }
    };

    // --- Xá»¬ LÃ PHÃM ENTER ---
    document.getElementById("u").addEventListener("keydown", (e) => {
        if (e.key === "Enter") document.getElementById("p").focus();
    });

    document.getElementById("p").addEventListener("keydown", (e) => {
        if (e.key === "Enter") register();
    });
</script>

</body>
</html>